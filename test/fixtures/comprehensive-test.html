<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sireno Assistant - Comprehensive Test Page</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #f9fafb;
    }

    h1 {
      color: #1f2937;
      margin-bottom: 8px;
    }

    p {
      color: #6b7280;
      margin-bottom: 32px;
    }

    .test-section {
      background: white;
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .test-section h2 {
      color: #374151;
      margin-bottom: 16px;
      font-size: 20px;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 8px;
    }

    .test-section p {
      font-size: 14px;
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: 600;
      color: #374151;
      margin-bottom: 6px;
      font-size: 14px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="url"],
    textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    input:focus,
    textarea:focus,
    [contenteditable]:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    [contenteditable] {
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      min-height: 80px;
      background: white;
    }

    [contenteditable]:empty:before {
      content: attr(data-placeholder);
      color: #9ca3af;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 32px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal h3 {
      margin-bottom: 20px;
      color: #1f2937;
    }

    button {
      padding: 10px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: opacity 0.2s;
    }

    button:hover {
      opacity: 0.9;
    }

    .inline-block {
      display: inline-block;
      margin-right: 10px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
    }

    .focus-trap-container {
      position: relative;
      background: #fef3c7;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #fbbf24;
    }

    .warning {
      background: #fef3c7;
      color: #92400e;
      padding: 12px;
      border-radius: 6px;
      font-size: 13px;
      margin-bottom: 16px;
    }

    code {
      background: #f3f4f6;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 13px;
      color: #dc2626;
    }

    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status.success {
      background: #d1fae5;
      color: #065f46;
    }

    .status.test {
      background: #dbeafe;
      color: #1e40af;
    }
  </style>
</head>
<body>
  <h1>‚ú® Sireno Assistant - Comprehensive Test Page</h1>
  <p>Test all field detection and interaction scenarios. Open extension and try interacting with each field.</p>

  <!-- Basic Inputs -->
  <div class="test-section">
    <h2><span class="status success">Test 1</span> Basic Input Fields</h2>
    <p>Standard inputs with labels, placeholders, and various types.</p>
    
    <div class="grid">
      <div class="form-group">
        <label for="name">Name:</label>
        <input type="text" id="name" placeholder="Enter your name">
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="you@example.com">
      </div>

      <div class="form-group">
        <label for="phone">Phone:</label>
        <input type="tel" id="phone" placeholder="+1 (555) 000-0000">
      </div>

      <div class="form-group">
        <label for="website">Website:</label>
        <input type="url" id="website" placeholder="https://example.com">
      </div>
    </div>
  </div>

  <!-- Textareas -->
  <div class="test-section">
    <h2><span class="status success">Test 2</span> Textarea Fields</h2>
    <p>Multi-line text areas with different sizes.</p>

    <div class="form-group">
      <label for="bio">Bio:</label>
      <textarea id="bio" placeholder="Tell us about yourself..."></textarea>
    </div>

    <div class="form-group">
      <label for="comments">Comments:</label>
      <textarea id="comments" rows="6" placeholder="Share your thoughts..."></textarea>
    </div>
  </div>

  <!-- Content Editable -->
  <div class="test-section">
    <h2><span class="status success">Test 3</span> ContentEditable Elements</h2>
    <p>Rich text editors using <code>contenteditable</code> attribute.</p>

    <div class="form-group">
      <label>Rich Text (contenteditable="true"):</label>
      <div contenteditable="true" data-placeholder="Type your rich text here..."></div>
    </div>

    <div class="form-group">
      <label>Plain Text (contenteditable):</label>
      <div contenteditable data-placeholder="Boolean contenteditable..."></div>
    </div>

    <div class="form-group">
      <label>Plain Text Only (contenteditable="plaintext-only"):</label>
      <div contenteditable="plaintext-only" data-placeholder="Plaintext only mode..."></div>
    </div>
  </div>

  <!-- ARIA Textbox -->
  <div class="test-section">
    <h2><span class="status success">Test 4</span> ARIA Textbox</h2>
    <p>Custom inputs using <code>role="textbox"</code>.</p>

    <div class="form-group">
      <label>Custom Input (ARIA):</label>
      <div role="textbox" aria-label="Custom ARIA textbox" contenteditable data-placeholder="ARIA role=textbox..."></div>
    </div>
  </div>

  <!-- Inputs without labels -->
  <div class="test-section">
    <h2><span class="status test">Test 5</span> Inputs Without Labels</h2>
    <p>Fields that rely on placeholders, aria-label, or data attributes.</p>

    <div class="grid">
      <div class="form-group">
        <input type="text" placeholder="Placeholder only" aria-label="Field with placeholder">
      </div>

      <div class="form-group">
        <input type="text" aria-label="Aria label only">
      </div>

      <div class="form-group">
        <input type="text" data-testid="test-id-field" placeholder="Has data-testid">
      </div>

      <div class="form-group">
        <input type="text" name="field-name" placeholder="Has name attribute">
      </div>
    </div>
  </div>

  <!-- Dynamic Fields -->
  <div class="test-section">
    <h2><span class="status test">Test 6</span> Dynamically Added Fields</h2>
    <p>Test mutation observer and polling detection.</p>

    <button onclick="addDynamicField()">+ Add Dynamic Field</button>
    <div id="dynamic-container" style="margin-top: 16px;"></div>
  </div>

  <!-- Modal with Focus Trap -->
  <div class="test-section">
    <h2><span class="status test">Test 7</span> Modal with Fields</h2>
    <p>Test detection in modals and overlays.</p>

    <button onclick="openModal()">Open Modal</button>
  </div>

  <!-- Nested/Complex Structure -->
  <div class="test-section">
    <h2><span class="status test">Test 8</span> Complex Nested Structure</h2>
    <p>Fields in complex DOM hierarchies.</p>

    <div style="position: relative; border: 2px dashed #d1d5db; padding: 20px; border-radius: 8px;">
      <div style="transform: translateZ(0);">
        <div style="overflow: hidden;">
          <div class="form-group">
            <label for="nested-input">Deeply Nested Input:</label>
            <input type="text" id="nested-input" placeholder="Inside complex hierarchy">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Focus Trap Simulation -->
  <div class="test-section">
    <h2><span class="status test">Test 9</span> Focus Trap Simulation</h2>
    <p class="warning">‚ö†Ô∏è Simulates Bluesky/LinkedIn-style focus management with <code>stopPropagation()</code>.</p>

    <div class="focus-trap-container">
      <div class="form-group">
        <label for="trapped-input">Trapped Input (stopPropagation on keydown):</label>
        <input type="text" id="trapped-input" placeholder="Page captures all keydown events">
      </div>

      <div class="form-group">
        <label>Trapped ContentEditable:</label>
        <div id="trapped-editor" contenteditable data-placeholder="Simulates focus trap like Bluesky..."></div>
      </div>
    </div>
  </div>

  <!-- Scroll Test -->
  <div class="test-section">
    <h2><span class="status test">Test 10</span> Scroll Position Test</h2>
    <p>Test button positioning during scroll.</p>

    <div class="form-group">
      <label for="scroll-top">Top Input:</label>
      <input type="text" id="scroll-top" placeholder="Scroll down and back up">
    </div>

    <div style="height: 800px; display: flex; align-items: center; justify-content: center; background: #f3f4f6; border-radius: 8px;">
      <p style="color: #6b7280;">üëá Scroll down üëá</p>
    </div>

    <div class="form-group">
      <label for="scroll-bottom">Bottom Input:</label>
      <input type="text" id="scroll-bottom" placeholder="Button should stay positioned correctly">
    </div>
  </div>

  <!-- Modal HTML -->
  <div class="modal" id="test-modal">
    <div class="modal-content">
      <h3>Modal with Form Fields</h3>
      
      <div class="form-group">
        <label for="modal-name">Name in Modal:</label>
        <input type="text" id="modal-name" placeholder="Enter your name">
      </div>

      <div class="form-group">
        <label for="modal-message">Message:</label>
        <textarea id="modal-message" placeholder="Your message..." rows="4"></textarea>
      </div>

      <button onclick="closeModal()">Close Modal</button>
    </div>
  </div>

  <script>
    // Dynamic field addition
    let dynamicCount = 0;
    function addDynamicField() {
      dynamicCount++;
      const container = document.getElementById('dynamic-container');
      const div = document.createElement('div');
      div.className = 'form-group';
      div.innerHTML = `
        <label for="dynamic-${dynamicCount}">Dynamic Field #${dynamicCount}:</label>
        <input type="text" id="dynamic-${dynamicCount}" placeholder="Added at ${new Date().toLocaleTimeString()}">
      `;
      container.appendChild(div);
    }

    // Modal
    function openModal() {
      document.getElementById('test-modal').classList.add('active');
      setTimeout(() => {
        document.getElementById('modal-name').focus();
      }, 100);
    }

    function closeModal() {
      document.getElementById('test-modal').classList.remove('active');
    }

    // Focus trap simulation (like Bluesky/LinkedIn)
    document.addEventListener('DOMContentLoaded', () => {
      const trappedInput = document.getElementById('trapped-input');
      const trappedEditor = document.getElementById('trapped-editor');

      // Simulate page-level event capture (like Bluesky does)
      [trappedInput, trappedEditor].forEach(element => {
        if (element) {
          // Capture at document level with stopPropagation
          document.addEventListener('keydown', (e) => {
            if (document.activeElement === element) {
              console.log('[Focus Trap Test] Page captured keydown:', e.key);
              // Simulate what Bluesky/LinkedIn do - capture but don't stop
              // This tests if Sireno's iframe can still receive input
            }
          }, { capture: true });

          // Also test with stopPropagation on the element itself
          element.addEventListener('keydown', (e) => {
            // Don't actually stop it, just log (to keep page functional)
            console.log('[Focus Trap Test] Element received keydown:', e.key);
          });
        }
      });
    });

    // Close modal on background click
    document.getElementById('test-modal').addEventListener('click', (e) => {
      if (e.target.id === 'test-modal') {
        closeModal();
      }
    });

    // Log when buttons appear
    const observer = new MutationObserver((mutations) => {
      mutations.forEach((mutation) => {
        mutation.addedNodes.forEach((node) => {
          if (node instanceof HTMLElement && node.hasAttribute('data-sireno-button')) {
            console.log('[Test Page] Sireno button detected on:', node.parentElement);
          }
        });
      });
    });

    observer.observe(document.body, {
      childList: true,
      subtree: true
    });

    console.log('[Test Page] Comprehensive test page loaded');
  </script>
</body>
</html>
